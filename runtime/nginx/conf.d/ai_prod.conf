server {
  listen 80;
  server_name ai.254253.xyz;

  charset utf-8;

  # 业务前端静态资源
  location / {
    root /project-web/ai/prod/current;
    try_files $uri /index.html;
  }

  # 平台登录接口（全局）
  location = /api/auth/login {
    proxy_pass http://easydb-gateway:3000/api/auth/login;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
  }

  # 以下固定为业务前端统一入口，不暴露 /api/gw/:project/:env
  location = /api/auth/me {
    proxy_pass http://easydb-gateway:3000/api/gw/ai/prod/auth/me;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
  }

  location = /api/sql {
    proxy_pass http://easydb-gateway:3000/api/gw/ai/prod/sql;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
  }

  location = /api/health {
    proxy_pass http://easydb-gateway:3000/api/gw/ai/prod/health;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
  }
}
